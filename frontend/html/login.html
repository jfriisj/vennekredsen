<!doctype html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Admin login til Vennekredsens administrationspanel for at administrere ansøgninger"
    />
    <title>Login - Vennekredsen for Hashøjskolen</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap and FontAwesome -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom Styles -->
    <link href="style.css" rel="stylesheet" />

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  </head>
  <body>
    <!--Navigation bar-->
    <div id="nav-placeholder"></div>

    <!-- Page Header -->
    <header class="bg-primary text-white text-center py-5">
      <div class="container">
        <h1 class="display-4">Admin Login</h1>
        <p class="lead">Log ind for at administrere ansøgninger</p>
      </div>
    </header>

    <script>
      $(function () {
        $("#nav-placeholder").load("navbar.html");
      });
    </script>

    <main class="container mt-5 pt-5">
      <div class="row">
        <div class="col-md-6 offset-md-3">
          <!-- Intro section -->
          <div class="text-center mb-5">
            <h1><i class="fas fa-lock me-3 text-primary"></i>Admin Login</h1>
            <p class="lead">Log ind for at administrere ansøgninger</p>
          </div>

          <!-- Login form section -->
          <section id="vennekredsen" class="mb-5" aria-label="Login formular">
            <article class="card">
              <div class="card-body">
                <div id="loginMessage" class="alert d-none" role="alert"></div>

                <!-- Login form -->
                <form id="loginForm" class="login-form">
                  <div class="form-group">
                    <label for="username">
                      <i class="fas fa-user me-2"></i>Brugernavn:
                    </label>
                    <input
                      type="text"
                      class="form-control"
                      id="username"
                      required
                      placeholder="Indtast brugernavn"
                      autocomplete="username"
                    />
                  </div>

                  <div class="form-group">
                    <label for="password">
                      <i class="fas fa-key me-2"></i>Adgangskode:
                    </label>
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      required
                      placeholder="Indtast adgangskode"
                      autocomplete="current-password"
                    />
                  </div>

                  <div class="text-center">
                    <button
                      type="submit"
                      class="btn btn-primary btn-lg"
                      id="loginBtn"
                    >
                      <i class="fas fa-sign-in-alt me-2"></i>Log ind
                    </button>
                  </div>
                </form>
              </div>
            </article>
          </section>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4">
      <p>
        &copy; 2025 Vennekredsen for Hashøjskolen. Alle rettigheder forbeholdes.
      </p>
    </footer>

    <script>
      // Handle login form submission
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          doLogin();
        });

      // Handle login
      function doLogin() {
        const messageBox = document.getElementById("loginMessage");
        messageBox.classList.add("d-none");

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value;

        if (!username || !password) {
          showMessage(
            "Udfyld venligst både brugernavn og adgangskode",
            "danger"
          );
          return;
        }

        // Disable button during login
        const loginBtn = document.getElementById("loginBtn");
        loginBtn.disabled = true;
        loginBtn.innerHTML =
          '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Logger ind...';

        // Create the request data
        const loginData = { username, password };

        // Make the request using fetch API
        fetch("/api/admin/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(loginData),
        })
          .then(response => {
            return response.json().then(data => ({
              ok: response.ok,
              status: response.status,
              data,
            }));
          })
          .then(result => {
            if (result.ok) {
              // Success case
              showMessage("Login successful! Omdirigerer...", "success");

              // Store token and redirect
              localStorage.setItem("adminToken", result.data.token);

              setTimeout(() => {
                window.location.href = "admin-panel.html";
              }, 1000);
            } else {
              // Error case
              const errorMsg = result.data.message || "Login fejlede";
              showMessage(errorMsg, "danger");
              resetLoginButton();
            }
          })
          .catch(error => {
            // Network or other errors
            showMessage("Fejl ved forbindelse til serveren", "danger");
            resetLoginButton();
          });
      }

      // Reset login button
      function resetLoginButton() {
        const loginBtn = document.getElementById("loginBtn");
        loginBtn.disabled = false;
        loginBtn.innerHTML = '<i class="fas fa-sign-in-alt me-2"></i>Log ind';
      }

      // Helper function to show messages
      function showMessage(message, type) {
        const messageBox = document.getElementById("loginMessage");
        messageBox.textContent = message;
        messageBox.classList.remove("d-none");
        messageBox.classList.remove(
          "alert-success",
          "alert-danger",
          "alert-info"
        );
        messageBox.classList.add(`alert-${type}`);
      }

      // Check if already logged in
      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("adminToken");
        if (token) {
          showMessage("Allerede logget ind, viderestiller...", "info");
          setTimeout(() => {
            window.location.href = "admin-panel.html";
          }, 1000);
        }
      });
    </script>
  </body>
</html>
