<!doctype html>
<html lang="da">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Søg støtte fra Vennekredsen for Hashøjskolen - Ansøg om støtte til aktiviteter og projekter der gavner børnene"
    />
    <title>Søg støtte - Vennekredsen for Hashøjskolen</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Bootstrap and FontAwesome -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom Styles -->
    <link href="style.css" rel="stylesheet" />
    
    <style>
      .checkbox-group {
        background-color: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .checkbox-group .form-check {
        margin-bottom: 0.75rem;
        padding-left: 1.5rem;
      }
      
      .checkbox-group .form-check:last-child {
        margin-bottom: 0;
      }
      
      .checkbox-group .form-check-input {
        margin-top: 0.125rem;
      }
      
      .checkbox-group .form-check-label {
        color: #fff;
        line-height: 1.4;
      }
      
      .benefit-checkbox:checked + label {
        color: #28a745 !important;
        font-weight: 500;
      }
      
      #benefitsError {
        color: #dc3545;
        font-size: 0.875rem;
        margin-top: 0.5rem;
      }
    </style>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  </head>

  <body>
    <!-- Hero Section -->
    <header
      class="hero-section d-flex align-items-center justify-content-center text-center text-white"
      id="header"
    >
      <div class="container">
        <h1 class="hero-title mb-4">
          Ansøg om Støtte
        </h1>
        <p class="hero-subtitle lead mb-4">
          Ansøg om økonomisk støtte til dit projekt.
        </p>
        <div class="hero-actions">
          <a
            href="index.html"
            class="btn btn-primary btn-lg me-3"
            role="button"
            aria-label="Hjem"
          >
            <i class="fas fa-home me-2"></i>Hjem
          </a>
          <a
            href="ansogning.html"
            class="btn btn-primary btn-lg me-3"
            role="button"
            aria-label="Ansøg om støtte fra Vennekredsen"
          >
            <i class="fas fa-file-alt me-2"></i>Ansøg om støtte
          </a>
          <button
            type="button"
            class="btn btn-info btn-lg me-3"
            data-toggle="modal"
            data-target="#exampleModal"
            aria-label="Se eksempel på ansøgning"
          >
            <i class="fas fa-lightbulb me-2"></i>Se eksempel
          </button>
          <a
            href="tilmelding.html"
            class="btn btn-primary btn-lg me-3"
            role="button"
            aria-label="Tilmeld dig til arrangementer"
          >
            <i class="fas fa-calendar-plus me-2"></i>Tilmeld til Events
          </a>
          <a
            href="about.html"
            class="btn btn-primary btn-lg me-3"
            role="button"
            aria-label="Læs om Vennekredsen"
          >
            <i class="fas fa-info-circle me-2"></i>Om Os
          </a>
          <a
            href="admin-login.html"
            class="btn btn-primary btn-lg"
            role="button"
            aria-label="Login"
          >
            <i class="fas fa-sign-in-alt me-2"></i>Login
          </a>
        </div>
      </div>
    </header>
    
    <main class="container my-5">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <!-- Intro section -->
          <section class="text-center mb-5">
            <h2>Søg støtte fra Vennekredsen</h2>
            <p class="lead">
              Vennekredsen støtter aktiviteter og projekter der gavner børnene
              på Hashøjskolen
            </p>
            <div class="alert alert-info" role="alert">
              <i class="fas fa-lightbulb me-2"></i>
              <strong>Første gang du ansøger?</strong> 
              Klik på <strong>"Se eksempel"</strong> knappen ovenfor for at se hvordan en god ansøgning ser ud!
            </div>
          </section>

          <!-- Application form section -->
          <section id="vennekredsen" class="mb-5">
            <div class="card mb-4">
              <div class="card-body">
                <h4 class="card-title text-center">Indsend din ansøgning</h4>
                <h5 class="card-title text-center">Årlig pulje på 5000 kr.</h5>

                <!-- Progress Indicator -->
                <div class="progress-indicator">
                  <div class="progress-step active" data-step="1">
                    <div class="step-circle">1</div>
                    <div class="step-label">Grundinfo</div>
                  </div>
                  <div class="progress-step" data-step="2">
                    <div class="step-circle">2</div>
                    <div class="step-label">Projekt</div>
                  </div>
                  <div class="progress-step" data-step="3">
                    <div class="step-circle">3</div>
                    <div class="step-label">Gennemse</div>
                  </div>
                </div>

                <div
                  id="formResponseMessage"
                  class="alert d-none"
                  role="alert"
                ></div>

                <form id="ansoegningForm">
                  <!-- Step 1: Basic Information -->
                  <div class="form-section active" data-section="1">
                    <h5 class="mb-4 text-center" style="color: #fff">
                      Grundlæggende information
                    </h5>

                    <div class="form-group">
                      <label for="navn"
                        >Navn på ansøger:
                        <span class="text-danger">*</span></label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="navn"
                        name="navn"
                        required
                        placeholder="F.eks. Anna Jensen eller Klasse 3B"
                        aria-describedby="navnHelp"
                      />
                      <small id="navnHelp" class="form-text text-muted">
                        Angiv navnet på personen, klassen eller gruppen der
                        søger støtte
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="form-group">
                      <label for="email"
                        >E-mail: <span class="text-danger">*</span></label
                      >
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        name="email"
                        required
                        placeholder="din@email.dk"
                        aria-describedby="emailHelp"
                      />
                      <small id="emailHelp" class="form-text text-muted">
                        Vi kontakter dig på denne email med svar på din
                        ansøgning
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="form-navigation">
                      <div></div>
                      <button
                        type="button"
                        class="btn btn-primary"
                        id="nextStep1"
                      >
                        Næste <i class="fas fa-arrow-right"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Step 2: Project Details -->
                  <div class="form-section" data-section="2">
                    <h5 class="mb-4 text-center" style="color: #fff">
                      Projektdetaljer
                    </h5>

                    <div class="form-group">
                      <label for="belob"
                        >Ansøgt beløb: <span class="text-danger">*</span></label
                      >
                      <div class="input-group">
                        <input
                          type="number"
                          min="0"
                          max="5000"
                          step="1"
                          class="form-control"
                          id="belob"
                          name="belob"
                          required
                          placeholder="0"
                          aria-describedby="belobHelp"
                        />
                        <div class="input-group-append">
                          <span class="input-group-text">DKK</span>
                        </div>
                      </div>
                      <small id="belobHelp" class="form-text text-muted">
                        Maksimalt 5.000 kr. fra årets pulje. Skriv det fulde
                        beløb du har brug for.
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- Project Title -->
                    <div class="form-group">
                      <label for="projektTitel">
                        Projektets titel:
                        <span class="text-danger">*</span>
                      </label>
                      <input
                        type="text"
                        class="form-control"
                        id="projektTitel"
                        name="projektTitel"
                        required
                        placeholder="F.eks. Hygge-spilindsats til regnvejrsdage"
                        maxlength="100"
                      />
                      <small class="form-text text-muted">
                        Giv dit projekt en kort, beskrivende titel
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- Project Purpose -->
                    <div class="form-group">
                      <label for="projektFormaal">
                        Projektets formål:
                        <span class="text-danger">*</span>
                      </label>
                      <textarea
                        class="form-control"
                        id="projektFormaal"
                        name="projektFormaal"
                        rows="3"
                        required
                        placeholder="Hvad ønsker I at opnå med dette projekt?"
                        maxlength="300"
                      ></textarea>
                      <small class="form-text text-muted">
                        Beskriv kort hvad I vil opnå (max 300 tegn)
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- How it benefits all children -->
                    <div class="form-group">
                      <label class="form-label">
                        Hvordan kommer det alle børn til gode:
                        <span class="text-danger">*</span>
                      </label>
                      <small class="form-text text-muted mb-2">
                        Vælg mindst 2 punkter der beskriver hvordan projektet inkluderer alle børn:
                      </small>
                      
                      <div class="checkbox-group">
                        <div class="form-check">
                          <input class="form-check-input benefit-checkbox" type="checkbox" id="benefit1" name="benefits" value="Inkluderende aktiviteter - alle kan deltage uanset baggrund eller evner">
                          <label class="form-check-label" for="benefit1">
                            <strong>Inkluderende aktiviteter</strong> - alle kan deltage uanset baggrund eller evner
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input benefit-checkbox" type="checkbox" id="benefit2" name="benefits" value="Tværgående fællesskab - skaber nye venskaber på tværs af klasser">
                          <label class="form-check-label" for="benefit2">
                            <strong>Tværgående fællesskab</strong> - skaber nye venskaber på tværs af klasser
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input benefit-checkbox" type="checkbox" id="benefit3" name="benefits" value="Lige adgang - børn der ikke har meget hjemmefra får samme muligheder">
                          <label class="form-check-label" for="benefit3">
                            <strong>Lige adgang</strong> - børn der ikke har meget hjemmefra får samme muligheder
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input benefit-checkbox" type="checkbox" id="benefit4" name="benefits" value="Læring og udvikling - styrker børnenes færdigheder gennem leg og aktivitet">
                          <label class="form-check-label" for="benefit4">
                            <strong>Læring og udvikling</strong> - styrker børnenes færdigheder gennem leg og aktivitet
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input benefit-checkbox" type="checkbox" id="benefit5" name="benefits" value="Fysisk aktivitet - får børn i bevægelse og aktiv leg">
                          <label class="form-check-label" for="benefit5">
                            <strong>Fysisk aktivitet</strong> - får børn i bevægelse og aktiv leg
                          </label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input benefit-checkbox" type="checkbox" id="benefit6" name="benefits" value="Kreativ udfoldelse - mulighed for kunstnerisk og kreativ udvikling">
                          <label class="form-check-label" for="benefit6">
                            <strong>Kreativ udfoldelse</strong> - mulighed for kunstnerisk og kreativ udvikling
                          </label>
                        </div>
                      </div>
                      <div class="invalid-feedback" id="benefitsError"></div>
                    </div>

                    <!-- Concrete use of funds -->
                    <div class="form-group">
                      <label for="konkretBrug">
                        Konkret brug af midlerne:
                        <span class="text-danger">*</span>
                      </label>
                      <textarea
                        class="form-control"
                        id="konkretBrug"
                        name="konkretBrug"
                        rows="4"
                        required
                        placeholder="• Brætspil (8 forskellige): 600 kr.&#10;• Puslespil (6 stk): 300 kr.&#10;• Kort- og terningespil: 200 kr.&#10;• Opbevaring: 100 kr."
                        maxlength="400"
                      ></textarea>
                      <small class="form-text text-muted">
                        List konkrete ting I vil købe med estimerede priser (max 400 tegn)
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- How it will work -->
                    <div class="form-group">
                      <label for="hvordan">
                        Sådan vil det fungere:
                        <span class="text-danger">*</span>
                      </label>
                      <textarea
                        class="form-control"
                        id="hvordan"
                        name="hvordan"
                        rows="3"
                        required
                        placeholder="Hvordan vil I implementere og bruge projektet i praksis?"
                        maxlength="300"
                      ></textarea>
                      <small class="form-text text-muted">
                        Beskriv kort hvordan projektet vil fungere i hverdagen (max 300 tegn)
                      </small>
                      <div class="invalid-feedback"></div>
                    </div>

                    <!-- Long-term benefits -->
                    <div class="form-group">
                      <label for="langsigtet">
                        Langsigtede fordele:
                      </label>
                      <textarea
                        class="form-control"
                        id="langsigtet"
                        name="langsigtet"
                        rows="2"
                        placeholder="Hvilke fordele vil projektet have på længere sigt? (valgfrit)"
                        maxlength="200"
                      ></textarea>
                      <small class="form-text text-muted">
                        Valgfrit: Beskriv langsigtede effekter (max 200 tegn)
                      </small>
                    </div>

                    <!-- Why important now -->
                    <div class="form-group">
                      <label for="hvorforNu">
                        Hvorfor det er vigtigt nu:
                      </label>
                      <textarea
                        class="form-control"
                        id="hvorforNu"
                        name="hvorforNu"
                        rows="2"
                        placeholder="Hvorfor er dette projekt særligt vigtigt lige nu? (valgfrit)"
                        maxlength="200"
                      ></textarea>
                      <small class="form-text text-muted">
                        Valgfrit: Forklar aktualiteten (max 200 tegn)
                      </small>
                    </div>

                    <div class="form-navigation">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        id="prevStep2"
                      >
                        <i class="fas fa-arrow-left"></i> Tilbage
                      </button>
                      <button
                        type="button"
                        class="btn btn-primary"
                        id="nextStep2"
                      >
                        Næste <i class="fas fa-arrow-right"></i>
                      </button>
                    </div>
                  </div>

                  <!-- Step 3: Review and Submit -->
                  <div class="form-section" data-section="3">
                    <h5 class="mb-4 text-center" style="color: #fff">
                      Gennemse din ansøgning
                    </h5>

                    <div
                      class="card mb-4"
                      style="background-color: #495057 !important"
                    >
                      <div class="card-body">
                        <h6 class="card-title" style="color: #fff">
                          Ansøgningsoplysninger
                        </h6>
                        <div class="row">
                          <div class="col-md-6">
                            <p>
                              <strong>Ansøger:</strong>
                              <span id="reviewNavn"></span>
                            </p>
                            <p>
                              <strong>E-mail:</strong>
                              <span id="reviewEmail"></span>
                            </p>
                          </div>
                          <div class="col-md-6">
                            <p>
                              <strong>Beløb:</strong>
                              <span id="reviewBelob"></span> DKK
                            </p>
                            <p>
                              <strong>Projekt:</strong>
                              <span id="reviewTitel"></span>
                            </p>
                          </div>
                        </div>
                        
                        <hr style="border-color: #666;">
                        
                        <div class="mb-3">
                          <p><strong>Projektets formål:</strong></p>
                          <p id="reviewFormaal" style="background-color: #444; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;"></p>
                        </div>

                        <div class="mb-3">
                          <p><strong>Hvordan kommer det alle børn til gode:</strong></p>
                          <ul id="reviewBenefits" style="background-color: #444; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;"></ul>
                        </div>

                        <div class="mb-3">
                          <p><strong>Konkret brug af midlerne:</strong></p>
                          <p id="reviewKonkret" style="background-color: #444; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0; white-space: pre-line;"></p>
                        </div>

                        <div class="mb-3">
                          <p><strong>Sådan vil det fungere:</strong></p>
                          <p id="reviewHvordan" style="background-color: #444; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;"></p>
                        </div>

                        <div id="reviewLangsigtetSection" class="mb-3" style="display: none;">
                          <p><strong>Langsigtede fordele:</strong></p>
                          <p id="reviewLangsigtet" style="background-color: #444; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;"></p>
                        </div>

                        <div id="reviewHvorforNuSection" class="mb-3" style="display: none;">
                          <p><strong>Hvorfor det er vigtigt nu:</strong></p>
                          <p id="reviewHvorforNu" style="background-color: #444; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;"></p>
                        </div>
                      </div>
                    }                    <!-- GDPR Consent -->
                    <div class="form-group">
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="gdprConsent"
                          required
                        />
                        <label class="form-check-label" for="gdprConsent">
                          <span class="text-danger">*</span> Jeg accepterer, at
                          Vennekredsen behandler mine personoplysninger med det
                          formål at vurdere og behandle min ansøgning om støtte.
                          Mine oplysninger vil blive behandlet fortroligt.
                        </label>
                      </div>
                      <div class="invalid-feedback"></div>
                    </div>

                    <div class="form-navigation">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        id="prevStep3"
                      >
                        <i class="fas fa-arrow-left"></i> Tilbage
                      </button>
                      <button
                        type="submit"
                        class="btn btn-success btn-lg"
                        id="submitBtn"
                      >
                        <span
                          id="submitSpinner"
                          class="spinner-border spinner-border-sm d-none"
                          role="status"
                          aria-hidden="true"
                        ></span>
                        <i class="fas fa-paper-plane"></i> Send ansøgning
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </div>

            <div class="card">
              <div class="card-body">
                <h4 class="card-title text-center">Godkendte Ansøgninger</h4>

                <div class="text-center mb-3" id="loading-applications">
                  <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Indlæser...</span>
                  </div>
                  <p>Henter godkendte Ansøgninger...</p>
                </div>

                <div id="approvedProjects" class="list-group mt-4"></div>

                <div
                  id="noApprovedProjects"
                  class="alert alert-info text-center d-none mt-3"
                >
                  Der er ingen godkendte Ansøgninger at vise.
                </div>

                <div class="alert alert-success mt-3">
                  <strong>Information:</strong> Alle godkendte ansøgninger vises
                  offentligt på denne side uden personlige oplysninger.
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4">
      <p>
        &copy; 2025 Vennekredsen for Hashøjskolen. Alle rettigheder forbeholdes.
      </p>
    </footer>

    <script>
      // Wizard functionality
      let currentStep = 1;
      const totalSteps = 3;

      // Initialize wizard
      document.addEventListener("DOMContentLoaded", function () {
        setupFormValidation();
        setupWizardNavigation();
        loadApprovedProjects();
      });

      // Setup wizard navigation
      function setupWizardNavigation() {
        // Next step buttons
        document.getElementById("nextStep1").addEventListener("click", () => {
          if (validateStep(1)) {
            goToStep(2);
          }
        });

        document.getElementById("nextStep2").addEventListener("click", () => {
          if (validateStep(2)) {
            updateReviewSection();
            goToStep(3);
          }
        });

        // Previous step buttons
        document.getElementById("prevStep2").addEventListener("click", () => {
          goToStep(1);
        });

        document.getElementById("prevStep3").addEventListener("click", () => {
          goToStep(2);
        });
      }

      // Navigate to specific step
      function goToStep(step) {
        // Hide all sections
        document.querySelectorAll(".form-section").forEach(section => {
          section.classList.remove("active");
        });

        // Show current section
        document
          .querySelector(`[data-section="${step}"]`)
          .classList.add("active");

        // Update progress indicator
        document.querySelectorAll(".progress-step").forEach((stepEl, index) => {
          stepEl.classList.remove("active", "completed");
          if (index + 1 < step) {
            stepEl.classList.add("completed");
            stepEl.querySelector(".step-circle").innerHTML =
              '<i class="fas fa-check"></i>';
          } else if (index + 1 === step) {
            stepEl.classList.add("active");
            stepEl.querySelector(".step-circle").innerHTML = index + 1;
          } else {
            stepEl.querySelector(".step-circle").innerHTML = index + 1;
          }
        });

        currentStep = step;
      }

      // Validate current step
      function validateStep(step) {
        let isValid = true;
        const section = document.querySelector(`[data-section="${step}"]`);
        
        if (step === 2) {
          // Special validation for step 2 with new structured form
          isValid = validateStep2();
        } else {
          const inputs = section.querySelectorAll(
            "input[required], textarea[required]"
          );

          inputs.forEach(input => {
            if (!validateInput(input)) {
              isValid = false;
            }
          });
        }

        return isValid;
      }

      // Special validation for step 2
      function validateStep2() {
        let isValid = true;

        // Validate project title
        const projektTitel = document.getElementById("projektTitel");
        if (!validateInput(projektTitel)) isValid = false;

        // Validate project purpose
        const projektFormaal = document.getElementById("projektFormaal");
        if (!validateInput(projektFormaal)) isValid = false;

        // Validate benefits checkboxes (at least 2 must be selected)
        const checkedBenefits = document.querySelectorAll('.benefit-checkbox:checked');
        const benefitsError = document.getElementById("benefitsError");
        if (checkedBenefits.length < 2) {
          isValid = false;
          benefitsError.textContent = "Vælg mindst 2 punkter der beskriver hvordan projektet kommer alle børn til gode";
          benefitsError.style.display = "block";
        } else {
          benefitsError.style.display = "none";
        }

        // Validate concrete use
        const konkretBrug = document.getElementById("konkretBrug");
        if (!validateInput(konkretBrug)) isValid = false;

        // Validate how it works
        const hvordan = document.getElementById("hvordan");
        if (!validateInput(hvordan)) isValid = false;

        // Optional fields don't need validation but should be checked for length
        const langsigtet = document.getElementById("langsigtet");
        if (langsigtet.value.length > 200) {
          langsigtet.classList.add("is-invalid");
          langsigtet.parentNode.querySelector(".invalid-feedback").textContent = "Må ikke overstige 200 tegn";
          isValid = false;
        }

        const hvorforNu = document.getElementById("hvorforNu");
        if (hvorforNu.value.length > 200) {
          hvorforNu.classList.add("is-invalid");
          hvorforNu.parentNode.querySelector(".invalid-feedback").textContent = "Må ikke overstige 200 tegn";
          isValid = false;
        }

        return isValid;
      }

      // Validate individual input
      function validateInput(input) {
        const value = input.value.trim();
        const type = input.type;
        let isValid = true;
        let message = "";

        // Remove previous validation classes
        input.classList.remove("is-valid", "is-invalid");

        // Required field validation
        if (input.required && !value) {
          isValid = false;
          message = "Dette felt er påkrævet";
        }
        // Email validation
        else if (type === "email" && value) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(value)) {
            isValid = false;
            message = "Indtast en gyldig email-adresse";
          }
        }
        // Number validation (amount)
        else if (type === "number" && value) {
          const numValue = parseFloat(value);
          if (isNaN(numValue) || numValue <= 0) {
            isValid = false;
            message = "Indtast et gyldigt beløb større end 0";
          } else if (numValue > 5000) {
            isValid = false;
            message = "Beløbet kan ikke overstige 5.000 kr.";
          }
        }
        // Textarea validation with specific requirements
        else if (input.tagName === "TEXTAREA" && value) {
          const maxLength = parseInt(input.maxLength) || 1000;
          
          if (input.id === "projektFormaal" && value.length < 20) {
            isValid = false;
            message = "Beskriv formålet mere detaljeret (mindst 20 tegn)";
          } else if (input.id === "konkretBrug" && value.length < 30) {
            isValid = false;
            message = "Beskriv den konkrete brug mere detaljeret (mindst 30 tegn)";
          } else if (input.id === "hvordan" && value.length < 20) {
            isValid = false;
            message = "Beskriv hvordan det vil fungere mere detaljeret (mindst 20 tegn)";
          } else if (value.length > maxLength) {
            isValid = false;
            message = `Må ikke overstige ${maxLength} tegn`;
          }
        }
        // Text input validation
        else if (input.type === "text" && value) {
          const maxLength = parseInt(input.maxLength) || 100;
          if (value.length > maxLength) {
            isValid = false;
            message = `Må ikke overstige ${maxLength} tegn`;
          } else if (input.id === "projektTitel" && value.length < 5) {
            isValid = false;
            message = "Titlen skal være mindst 5 tegn lang";
          }
        }

        // Apply validation feedback
        if (isValid && value) {
          input.classList.add("is-valid");
        } else if (!isValid) {
          input.classList.add("is-invalid");
        }

        // Update feedback message
        const feedback = input.parentNode.querySelector(".invalid-feedback");
        if (feedback) {
          feedback.textContent = message;
        }

        return isValid;
      }

      // Setup real-time validation
      function setupFormValidation() {
        const inputs = document.querySelectorAll(
          "#ansoegningForm input, #ansoegningForm textarea"
        );

        inputs.forEach(input => {
          // Validate on blur
          input.addEventListener("blur", () => {
            validateInput(input);
          });

          // Clear validation on focus
          input.addEventListener("focus", () => {
            input.classList.remove("is-valid", "is-invalid");
          });

          // Real-time validation for amount field
          if (input.id === "belob") {
            input.addEventListener("input", () => {
              const value = parseFloat(input.value);
              if (value > 5000) {
                input.value = 5000;
              }
            });
          }
        });

        // Checkbox validation
        document
          .getElementById("gdprConsent")
          .addEventListener("change", function () {
            this.classList.remove("is-valid", "is-invalid");
            if (this.checked) {
              this.classList.add("is-valid");
            }
          });
      }



      // Update review section
      function updateReviewSection() {
        // Basic info
        document.getElementById("reviewNavn").textContent =
          document.getElementById("navn").value;
        document.getElementById("reviewEmail").textContent =
          document.getElementById("email").value;
        document.getElementById("reviewBelob").textContent =
          new Intl.NumberFormat("da-DK").format(
            document.getElementById("belob").value
          );
        
        // Project details
        document.getElementById("reviewTitel").textContent =
          document.getElementById("projektTitel").value;
        document.getElementById("reviewFormaal").textContent =
          document.getElementById("projektFormaal").value;
        
        // Benefits
        const checkedBenefits = document.querySelectorAll('.benefit-checkbox:checked');
        const benefitsList = document.getElementById("reviewBenefits");
        benefitsList.innerHTML = "";
        checkedBenefits.forEach(checkbox => {
          const li = document.createElement("li");
          li.textContent = checkbox.value;
          benefitsList.appendChild(li);
        });
        
        // Concrete use
        document.getElementById("reviewKonkret").textContent =
          document.getElementById("konkretBrug").value;
        
        // How it works
        document.getElementById("reviewHvordan").textContent =
          document.getElementById("hvordan").value;
        
        // Optional fields
        const langsigtet = document.getElementById("langsigtet").value.trim();
        const langsigtetSection = document.getElementById("reviewLangsigtetSection");
        if (langsigtet) {
          document.getElementById("reviewLangsigtet").textContent = langsigtet;
          langsigtetSection.style.display = "block";
        } else {
          langsigtetSection.style.display = "none";
        }
        
        const hvorforNu = document.getElementById("hvorforNu").value.trim();
        const hvorforNuSection = document.getElementById("reviewHvorforNuSection");
        if (hvorforNu) {
          document.getElementById("reviewHvorforNu").textContent = hvorforNu;
          hvorforNuSection.style.display = "block";
        } else {
          hvorforNuSection.style.display = "none";
        }
      }

      // Form submission handler
      document
        .getElementById("ansoegningForm")
        .addEventListener("submit", async function (event) {
          event.preventDefault();

          // Validate final step
          if (!validateStep(3)) {
            return;
          }

          // Check GDPR consent
          const gdprConsent = document.getElementById("gdprConsent");
          if (!gdprConsent.checked) {
            gdprConsent.classList.add("is-invalid");
            const feedback =
              gdprConsent.parentNode.parentNode.querySelector(
                ".invalid-feedback"
              );
            if (feedback) {
              feedback.textContent =
                "Du skal acceptere behandling af personoplysninger for at fortsætte";
            }
            return;
          }

          // Show loading state
          const submitBtn = document.getElementById("submitBtn");
          const submitSpinner = document.getElementById("submitSpinner");
          submitBtn.disabled = true;
          submitSpinner.classList.remove("d-none");

          // Clear previous messages
          const messageBox = document.getElementById("formResponseMessage");
          messageBox.classList.add("d-none");

          // Prepare structured description
          const projektTitel = document.getElementById("projektTitel").value.trim();
          const projektFormaal = document.getElementById("projektFormaal").value.trim();
          const konkretBrug = document.getElementById("konkretBrug").value.trim();
          const hvordan = document.getElementById("hvordan").value.trim();
          const langsigtet = document.getElementById("langsigtet").value.trim();
          const hvorforNu = document.getElementById("hvorforNu").value.trim();
          
          // Get selected benefits
          const checkedBenefits = document.querySelectorAll('.benefit-checkbox:checked');
          const benefits = Array.from(checkedBenefits).map(cb => cb.value);
          
          // Build complete description
          let fullDescription = `📋 ${projektTitel}\n\n`;
          fullDescription += `🎯 Projektets formål:\n${projektFormaal}\n\n`;
          fullDescription += `✅ Hvordan kommer det alle børn til gode:\n`;
          benefits.forEach(benefit => {
            fullDescription += `• ${benefit}\n`;
          });
          fullDescription += `\n💰 Konkret brug af midlerne:\n${konkretBrug}\n\n`;
          fullDescription += `⚙️ Sådan vil det fungere:\n${hvordan}`;
          
          if (langsigtet) {
            fullDescription += `\n\n📈 Langsigtede fordele:\n${langsigtet}`;
          }
          
          if (hvorforNu) {
            fullDescription += `\n\n⏰ Hvorfor det er vigtigt nu:\n${hvorforNu}`;
          }

          const formData = {
            navn: document.getElementById("navn").value.trim(),
            email: document.getElementById("email").value.trim(),
            belob: parseFloat(document.getElementById("belob").value),
            beskrivelse: fullDescription,
          };

          try {
            const response = await fetch("/api/ansoegning", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(formData),
            });

            const result = await response.json();

            // Display success message
            messageBox.innerHTML = `
              <i class="fas fa-check-circle"></i>
              <strong>Tak for din ansøgning!</strong><br>
              Din ansøgning er modtaget og vil blive behandlet hurtigst muligt. 
              Vi vender tilbage til <strong>${formData.email}</strong> med svar.
            `;
            messageBox.classList.remove("d-none", "alert-danger");
            messageBox.classList.add("alert-success");

            // Reset form and go back to step 1
            document.getElementById("ansoegningForm").reset();
            // Clear benefit checkboxes
            document.querySelectorAll('.benefit-checkbox').forEach(cb => cb.checked = false);
            goToStep(1);

            // Scroll to top
            document
              .querySelector(".card")
              .scrollIntoView({ behavior: "smooth" });

            // Refresh approved projects list
            loadApprovedProjects();
          } catch (error) {
            // Display error message
            messageBox.innerHTML = `
              <i class="fas fa-exclamation-triangle"></i>
              <strong>Der opstod en fejl:</strong><br>
              ${error.message || "Kunne ikke behandle din anmodning. Prøv igen senere."}
            `;
            messageBox.classList.remove("d-none", "alert-success");
            messageBox.classList.add("alert-danger");
            console.error("Error submitting application:", error);
          } finally {
            // Reset button state
            submitBtn.disabled = false;
            submitSpinner.classList.add("d-none");
          }
        });

      // Load approved projects for public display
      async function loadApprovedProjects() {
        try {
          document.getElementById("loading-applications").style.display =
            "block";
          document.getElementById("approvedProjects").innerHTML = "";
          document.getElementById("noApprovedProjects").classList.add("d-none");

          const response = await fetch("/api/approved-projects");

          if (!response.ok) {
            throw new Error(`HTTP error: ${response.status}`);
          }

          const projects = await response.json();

          if (projects.length === 0) {
            document
              .getElementById("noApprovedProjects")
              .classList.remove("d-none");
            return;
          }

          const container = document.getElementById("approvedProjects");

          projects.forEach(project => {
            const card = document.createElement("div");
            card.className = "card mb-3";
            card.style.backgroundColor = "#444";

            // Format amount
            const formattertBelob = new Intl.NumberFormat("da-DK", {
              style: "currency",
              currency: "DKK",
              minimumFractionDigits: 0,
            }).format(project.belob);

            // Format date
            const oprettetDato = project.godkendt_dato
              ? new Date(project.godkendt_dato)
              : null;
            const formattertDato = oprettetDato
              ? new Intl.DateTimeFormat("da-DK", {
                  year: "numeric",
                  month: "long",
                }).format(oprettetDato)
              : "";

            card.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title" style="color: #fff !important;">Støtte på ${formattertBelob}</h5>
                        <p class="card-text" style="color: #fff !important;">${escapeHTML(project.beskrivelse)}</p>
                        <p class="card-text"><small class="text-muted" style="color: #adb5bd !important;">Godkendt: ${formattertDato}</small></p>
                    </div>
                `;

            container.appendChild(card);
          });
        } catch (error) {
          console.error("Error loading approved projects:", error);
        } finally {
          document.getElementById("loading-applications").style.display =
            "none";
        }
      }

      // Helper function to prevent XSS
      function escapeHTML(str) {
        if (!str) return "";
        return str
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }
    </script>

    <!-- Example Application Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="background-color: #495057; color: #fff;">
          <div class="modal-header" style="border-bottom: 1px solid #6c757d;">
            <h5 class="modal-title" id="exampleModalLabel">
              <i class="fas fa-lightbulb me-2"></i>Eksempel på god ansøgning
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Luk" style="color: #fff;">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="card mb-3" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-info-circle me-2"></i>Grundlæggende oplysninger
                </h6>
                <div class="row">
                  <div class="col-md-6">
                    <p><strong>Ansøger:</strong> Susanne Møller (SFO-leder)</p>
                    <p><strong>E-mail:</strong> susanne.moller@hashojskolen.dk</p>
                  </div>
                  <div class="col-md-6">
                    <p><strong>Beløb:</strong> 1.200 DKK</p>
                    <p><strong>Projekt:</strong> Hygge-spilindsats til regnvejrsdage</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="card mb-3" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-bullseye me-2"></i>Projektets formål
                </h6>
                <p style="background-color: #495057; padding: 0.75rem; border-radius: 0.25rem;">
                  Vi ønsker at skabe en samling af brætspil, puslespil og kortspil som alle børn på Hashøjskolen kan bruge når vejret ikke tillader udendørs leg. Især på regnvejrsdage og i vintermånederne mangler vi aktiviteter hvor alle børn kan deltage sammen.
                </p>
              </div>
            </div>

            <div class="card mb-3" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-check-circle me-2"></i>Hvordan kommer det alle børn til gode
                </h6>
                <ul style="background-color: #495057; padding: 0.75rem; border-radius: 0.25rem;">
                  <li>✅ <strong>Inkluderende aktiviteter</strong> - alle kan deltage uanset fysiske evner eller sprogfærdigheder</li>
                  <li>✅ <strong>Tværgående fællesskab</strong> - ældre børn kan hjælpe yngre med spilleregler og skabe nye venskaber</li>
                  <li>✅ <strong>Lige adgang</strong> - børn der ikke har mange spil hjemme får samme muligheder for hygge og leg</li>
                  <li>✅ <strong>Læring og udvikling</strong> - spillene træner tålmodighed, strategi og samarbejde på en sjov måde</li>
                </ul>
              </div>
            </div>

            <div class="card mb-3" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-coins me-2"></i>Konkret brug af midlerne
                </h6>
                <div style="background-color: #495057; padding: 0.75rem; border-radius: 0.25rem; white-space: pre-line;">• <strong>Brætspil (8 forskellige):</strong> 600 kr.
  - Ludo, Yatzy, UNO, Alias Junior
  - Memory spil i forskellige sværhedsgrader
  - Gæt hvem? og lignende enkle spil

• <strong>Puslespil (6 stk):</strong> 300 kr.
  - 100-500 brikker i forskellige motiver
  - Både for yngre og ældre børn

• <strong>Kort- og terningespil:</strong> 200 kr.
  - Almindelige spillekort, terninger
  - Enkle kortspil som Sorteper, Fisk

• <strong>Opbevaring:</strong> 100 kr.
  - Hylder og kasser så spillene holdes i orden</div>
              </div>
            </div>

            <div class="card mb-3" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-cogs me-2"></i>Sådan vil det fungere
                </h6>
                <p style="background-color: #495057; padding: 0.75rem; border-radius: 0.25rem;">
                  Spillene placeres i SFO-lokalet og klasseværelserne, så børnene kan låne dem når vejret ikke tillader udendørs aktiviteter. De ældre børn kan hjælpe de yngre med at lære spillene, hvilket skaber naturlige mentorrelationer.
                </p>
              </div>
            </div>

            <div class="card mb-3" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-chart-line me-2"></i>Langsigtede fordele
                </h6>
                <ul style="background-color: #495057; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;">
                  <li>Mindre konflikter i regnvejrspauserne når børnene har noget meningsfuldt at lave</li>
                  <li>Styrket sammenhold når børn fra forskellige klasser spiller sammen</li>
                  <li>Bedre koncentrationsevne og sociale færdigheder gennem spil</li>
                  <li>Tryggere miljø for børn der finder udendørs leg udfordrende</li>
                </ul>
              </div>
            </div>

            <div class="card" style="background-color: #6c757d; border: none;">
              <div class="card-body">
                <h6 class="card-title text-warning">
                  <i class="fas fa-clock me-2"></i>Hvorfor det er vigtigt nu
                </h6>
                <p style="background-color: #495057; padding: 0.75rem; border-radius: 0.25rem; margin-bottom: 0;">
                  Mange familier har økonomiske udfordringer og har måske ikke råd til mange spil hjemme. Ved at have et fælles udvalg på skolen sikrer vi, at alle børn oplever glæden ved spil og får styrket deres sociale kompetencer.
                </p>
              </div>
            </div>
          </div>
          <div class="modal-footer" style="border-top: 1px solid #6c757d;">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
              <i class="fas fa-times me-2"></i>Luk
            </button>
            <button type="button" class="btn btn-success" data-dismiss="modal" onclick="scrollToForm()">
              <i class="fas fa-edit me-2"></i>Start min ansøgning
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Function to scroll to form after closing modal
      function scrollToForm() {
        setTimeout(() => {
          document.querySelector('#ansoegningForm').scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
          });
        }, 300);
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
